#include "lv_examples.h"

/**
 * Using radial gradient as background
 */
void radial_gradient_background(void)
{
    static const lv_color_t grad_colors[2] = {
        LV_COLOR_MAKE(0xEE, 0xEE, 0xEE),
        LV_COLOR_MAKE(0x80, 0x80, 0x80),
    };

    int32_t width = lv_display_get_horizontal_resolution(NULL);
    int32_t height = lv_display_get_vertical_resolution(NULL);

    static lv_style_t style;
    lv_style_init(&style);

    /*First define a color gradient. I use a white to light gray color map.*/
    static lv_grad_dsc_t grad;

    lv_grad_init_stops(&grad, grad_colors, NULL, NULL, sizeof(grad_colors) / sizeof(lv_color_t));

    /*Make a radial gradient with the center in the middle of the object, extending to the farthest corner*/
    lv_grad_radial_init(&grad, LV_GRAD_CENTER, LV_GRAD_CENTER, LV_GRAD_RIGHT, LV_GRAD_BOTTOM, LV_GRAD_EXTEND_PAD);

    /*Set gradient as background*/
    lv_style_set_bg_grad(&style, &grad);

    /*Create an object with the new style*/
    lv_obj_t * obj = lv_obj_create(lv_screen_active());
    lv_obj_add_style(obj, &style, 0);
    lv_obj_set_size(obj, width, height);
    lv_obj_center(obj);
}


static void slider_event_cb(lv_event_t * e);
static lv_obj_t * slider_label;
static lv_obj_t * slider_label2;

/**
 * A default slider with a label displaying the current value
 */
void progress_bar(void)
{
    /*Create a slider in the center of the display*/
    lv_obj_t * slider = lv_slider_create(lv_screen_active());
    lv_obj_set_pos(slider, 30, 300);
    lv_obj_add_event_cb(slider, slider_event_cb, LV_EVENT_VALUE_CHANGED, NULL);

    lv_obj_set_style_anim_duration(slider, 2000, 0);


    /* Hide the knob by making it transparent and size 0 */
    lv_obj_set_style_opa(slider, LV_OPA_TRANSP, LV_PART_KNOB);
    lv_obj_set_style_width(slider, 0, LV_PART_KNOB);
    lv_obj_set_style_height(slider, 0, LV_PART_KNOB);

    /* Set slider background (track) to medium grey */
    lv_obj_set_style_bg_color(slider, lv_color_hex(0x909090), LV_PART_MAIN);

    /* Set slider bar (filled portion) to light grey */
    lv_obj_set_style_bg_color(slider, lv_color_hex(0xDDDDDD), LV_PART_INDICATOR);



    /*Create labels below / beside the slider*/
    slider_label = lv_label_create(lv_screen_active());
    /* Show initial time format mm:ss instead of percent */
    lv_label_set_text(slider_label, "0:00");

    /* Static total length label */
    slider_label2 = lv_label_create(lv_screen_active());
    lv_label_set_text(slider_label2, "3:45");

    /* Align labels once at creation */
    lv_obj_align_to(slider_label, slider, LV_ALIGN_OUT_BOTTOM_LEFT, -10, 10);
    lv_obj_align_to(slider_label2, slider, LV_ALIGN_OUT_BOTTOM_RIGHT, 10, 10);


}

static void slider_event_cb(lv_event_t * e)
{
    lv_obj_t * slider = lv_event_get_target_obj(e);
    /* Format the slider value as minutes:seconds (mm:ss).
     * Interpretation: slider value represents seconds. Adjust if you use a different unit.
     */
    const int length_of_track_in_seconds = 225; // e.g., 3 minutes 45 seconds
    int val = (int)lv_slider_get_value(slider)*length_of_track_in_seconds/100; // assuming slider max is 100
    int mins = val / 60;
    int secs = val % 60;
    char buf[16];
    lv_snprintf(buf, sizeof(buf), "%d:%02d", mins, secs);
    lv_label_set_text(slider_label, buf);
}
